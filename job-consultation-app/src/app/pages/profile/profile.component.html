<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/main"></ion-back-button>
    </ion-buttons>
    <ion-title>Profile</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="profile-container">
    <ion-avatar class="profile-avatar">
      <img [src]="profile.profileImage || 'https://via.placeholder.com/150'" alt="Profile" />
    </ion-avatar>
    
    <h2>{{ profile.name || 'Your Name' }}</h2>
    
    <!-- Basic Profile Info (for both buyer and seller) -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Basic Information</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item>
          <ion-label position="floating">Name</ion-label>
          <ion-input [(ngModel)]="profile.name"></ion-input>
        </ion-item>
        
        <ion-item>
          <ion-label position="floating">Bio</ion-label>
          <ion-textarea [(ngModel)]="profile.bio" rows="4"></ion-textarea>
        </ion-item>
        
        <ion-item>
          <ion-label position="floating">Profile Image URL</ion-label>
          <ion-input [(ngModel)]="profile.profileImage"></ion-input>
        </ion-item>
      </ion-card-content>
    </ion-card>
    
    <!-- Seller-specific sections -->
    <ng-container *ngIf="isSeller">
      <!-- Expertise section -->
      <ion-card>
        <ion-card-header>
          <ion-card-title>Area of Expertise</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-item>
            <ion-label position="floating">Expertise</ion-label>
            <ion-input [(ngModel)]="profile.expertise"></ion-input>
          </ion-item>
          
          <ion-item>
            <ion-label position="floating">Minimum Price ($)</ion-label>
            <ion-input type="number" [(ngModel)]="profile.minimumPrice"></ion-input>
          </ion-item>
        </ion-card-content>
      </ion-card>
      
      <!-- Certificates section -->
      <ion-card>
        <ion-card-header>
          <ion-card-title>Certificates</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-list>
            <ion-item *ngFor="let cert of profile.certificates">
              <ion-label>
                <h3>{{ cert.name }}</h3>
                <p>{{ cert.issuer }} ({{ cert.year }})</p>
              </ion-label>
              <ion-button slot="end" fill="clear" color="danger" (click)="removeCertificate(cert)">
                <ion-icon name="trash-outline"></ion-icon>
              </ion-button>
            </ion-item>
          </ion-list>
          
          <div class="certificate-form">
            <ion-item>
              <ion-label position="floating">Certificate Name</ion-label>
              <ion-input [(ngModel)]="newCertificate.name"></ion-input>
            </ion-item>
            
            <ion-item>
              <ion-label position="floating">Issuer</ion-label>
              <ion-input [(ngModel)]="newCertificate.issuer"></ion-input>
            </ion-item>
            
            <ion-item>
              <ion-label position="floating">Year</ion-label>
              <ion-input type="number" [(ngModel)]="newCertificate.year"></ion-input>
            </ion-item>
            
            <ion-button expand="block" (click)="addCertificate()">
              Add Certificate
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
      
      <!-- Experience section -->
      <ion-card>
        <ion-card-header>
          <ion-card-title>Experience</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-list>
            <ion-item *ngFor="let exp of profile.experiences">
              <ion-label>
                <h3>{{ exp.title }}</h3>
                <p>{{ exp.company }}</p>
                <p>{{ formatDate(exp.startDate) }} - {{ exp.endDate ? formatDate(exp.endDate) : 'Present' }}</p>
                <p *ngIf="exp.description">{{ exp.description }}</p>
              </ion-label>
              <ion-button slot="end" fill="clear" color="danger" (click)="removeExperience(exp)">
                <ion-icon name="trash-outline"></ion-icon>
              </ion-button>
            </ion-item>
          </ion-list>
          
          <div class="experience-form">
            <ion-item>
              <ion-label position="floating">Title</ion-label>
              <ion-input [(ngModel)]="newExperience.title"></ion-input>
            </ion-item>
            
            <ion-item>
              <ion-label position="floating">Company</ion-label>
              <ion-input [(ngModel)]="newExperience.company"></ion-input>
            </ion-item>
            
            <ion-item>
              <ion-label position="floating">Start Date</ion-label>
              <ion-datetime-button datetime="startDate"></ion-datetime-button>
              <ion-modal [keepContentsMounted]="true">
                <ng-template>
                  <ion-datetime id="startDate" [(ngModel)]="newExperience.startDate"></ion-datetime>
                </ng-template>
              </ion-modal>
            </ion-item>
            
            <ion-item>
              <ion-label position="floating">End Date (leave empty if current)</ion-label>
              <ion-datetime-button datetime="endDate"></ion-datetime-button>
              <ion-modal [keepContentsMounted]="true">
                <ng-template>
                  <ion-datetime id="endDate" [(ngModel)]="newExperience.endDate"></ion-datetime>
                </ng-template>
              </ion-modal>
            </ion-item>
            
            <ion-item>
              <ion-label position="floating">Description</ion-label>
              <ion-textarea [(ngModel)]="newExperience.description" rows="3"></ion-textarea>
            </ion-item>
            
            <ion-button expand="block" (click)="addExperience()">
              Add Experience
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
    </ng-container>
    
    <!-- Buyer-specific sections -->
    <ng-container *ngIf="!isSeller">
      <ion-card>
        <ion-card-header>
          <ion-card-title>Payment Methods</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-list>
            <ion-item *ngFor="let payment of profile.paymentMethods">
              <ion-icon 
                [name]="payment.type === 'credit_card' ? 'card-outline' : 'logo-paypal'" 
                slot="start">
              </ion-icon>
              <ion-label>
                <h3>{{ payment.type === 'credit_card' ? payment.cardType + ' Card' : 'PayPal' }}</h3>
                <p *ngIf="payment.lastFourDigits">**** **** **** {{ payment.lastFourDigits }}</p>
              </ion-label>
              <ion-button slot="end" fill="clear" color="danger" (click)="removePaymentMethod(payment)">
                <ion-icon name="trash-outline"></ion-icon>
              </ion-button>
            </ion-item>
          </ion-list>
          
          <div class="payment-form">
            <ion-item>
              <ion-label>Payment Type</ion-label>
              <ion-select [(ngModel)]="newPayment.type">
                <ion-select-option value="credit_card">Credit Card</ion-select-option>
                <ion-select-option value="paypal">PayPal</ion-select-option>
              </ion-select>
            </ion-item>
            
            <ion-item *ngIf="newPayment.type === 'credit_card'">
              <ion-label position="floating">Card Number</ion-label>
              <ion-input type="text" maxlength="16" [(ngModel)]="cardNumber"></ion-input>
            </ion-item>
            
            <ion-item *ngIf="newPayment.type === 'credit_card'">
              <ion-label position="floating">Card Type</ion-label>
              <ion-select [(ngModel)]="newPayment.cardType">
                <ion-select-option value="Visa">Visa</ion-select-option>
                <ion-select-option value="Mastercard">Mastercard</ion-select-option>
                <ion-select-option value="American Express">American Express</ion-select-option>
              </ion-select>
            </ion-item>
            
            <ion-button expand="block" (click)="addPaymentMethod()">
              Add Payment Method
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
    </ng-container>
    
    <ion-button expand="block" color="secondary" (click)="saveProfile()">
      Save Profile
    </ion-button>
  </div>
</ion-content> 